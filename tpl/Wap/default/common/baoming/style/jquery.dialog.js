var jDialog=(function(g,c){var k=(function(){var o=navigator.userAgent.toLowerCase();return{version:(o.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(o),opera:/opera/.test(o),msie:/msie/.test(o)&&!/opera/.test(o),mozilla:/mozilla/.test(o)&&!/(compatible|webkit)/.test(o)}})();var f=k.msie&&parseInt(k.version,10)==6;var h=["show","close","resize","hide","enterKey","escKey"];var d=[];var e={modal:true,title:null,content:null,width:250,height:null,minWidth:200,minHeight:60,maxWidth:310,maxHeight:null,padding:"10px",fixed:true,left:null,top:null,closeable:true,hideOnClose:false,draggable:true,contentType:null,zIndex:99999,resizable:false,autoShow:true,autoMiddle:true,autoClose:0,showShadow:true,showTitle:true,textAlign:"inherit",buttonAlign:"right",dialogClassName:null,maskClassName:null,wobbleEnable:false,closeOnBodyClick:false,buttons:[],events:{}};var i=function(o){d.push(this);this.cfg=g.extend({},e,o);this.dom={element:null,buttons:[]};this._init()};i.prototype={constructor:i,_tempVars:{},title:function(o){if((o||"").length){this.dom.element.find(".j-dialog-title>span.j-dialog-txt").html(o||"");return this}else{return this.dom.element.find(".j-dialog-title>span.j-dialog-txt").html()}},content:function(o){if((o||"").length){this.dom.element.find(".j-dialog-body").html(o).css({"text-align":this.cfg.textAlign});return this}else{return g(".j-dialog-body",this.dom.element).html()}},width:function(o){if(parseInt(o,10)>=0){this.dom.element.css("width",o);return this}else{return parseInt(this.dom.element.css("width"),10)}},height:function(o){o=parseInt(o,10)||0;if(o){var p=0;var q=(this.cfg.padding||"").split(/\s+/);switch(q.length){case 4:case 3:p+=(parseInt(q[0],10)||0)+(parseInt(q[2],10)||0);break;case 2:case 1:p+=2*(parseInt(q[0],10)||0);break}p+=35;if(this.cfg.minHeight){o=Math.max(o,this.cfg.minHeight)}if(this.cfg.maxHeight){o=Math.min(o,this.cfg.maxHeight)}o-=p;g(".j-dialog-body",this.dom.element).css("height",o);return this}else{return parseInt(this.dom.element.css("height"),10)}},middle:function(){var s=g(document);var r=g(window);var t=this.cfg.fixed&&!f?[0,0]:[s.scrollLeft(),s.scrollTop()];var q=t[0]+(r.width()-this.dom.element.outerWidth())/2;var p=t[1]+(r.height()-this.dom.element.outerHeight())/2;p=(p>=0)?p:0;return this.position({left:q,top:p})},position:function(o){if((!o.left||isNaN(parseInt(o.left,10)))&&(!o.top||isNaN(parseInt(o.top,10)))){return this.dom.element.offset()}else{if(!o.left||isNaN(parseInt(o.left,10))){this.dom.element.css({top:o.top})}else{if(!o.top||isNaN(parseInt(o.top,10))){this.dom.element.css({left:o.left})}else{this.dom.element.css({left:o.left,top:o.top})}}this.triggerHandler("resize");return this}},show:function(){this.dom.element.show.apply(this.dom.element,arguments);if(this.mask){this.mask.cfg.safety=this.dom.element;this.mask.show.apply(this.mask,arguments)}if(this.cfg.autoClose){var o=this;setTimeout(function(){o.close()},parseInt(this.cfg.autoClose,10)||3000)}this.triggerHandler("show");return this},hide:function(){this.dom.element.hide();if(this.mask){this.mask.hide.apply(this.mask,arguments)}return this},close:function(){var p=this;if(!p.dom.element[0]){return this}p.triggerHandler("close");g(window).unbind("resize",this._tempVars.onResize);p.mask&&p.mask.remove();this._tempVars.dragObj&&this._tempVars.dragObj.remove();p.dom.element.remove();for(var q=0,o=d.length;q<o;q++){if(d[q]==p){d.splice(q,1);break}}return this},buttons:function(r){var p=this;if(r&&r.length>0){this.cfg.buttons=r;var s=[];g.each(r,function(x,w){var u,t="j-dialog-btn";if(w.type=="highlight"){t+=" x-highlight"}u=w.text||"确定";s.push('<input type="button" class="'+t+'" value="'+u+'" />')});var o=g('<div class="j-dialog-buttons"></div>').appendTo(this.dom.element).html(s.join(""));o.css("text-align",this.cfg.buttonAlign||"right");var q=this.dom.buttons=g("input[type=button]",o);g.each(r,function(u,t){var v=g(q[u]);v.click(function(w){if(t.handler&&typeof t.handler=="function"){t.handler.call(v[0],v,p)}});if(!f){v.hover(function(x){var w="x-hover";if(v.hasClass("x-highlight")){w="x-hlhover"}v.addClass(w)},function(w){v.removeClass("x-hover").removeClass("x-hlhover")})}});return this}else{return this.dom.buttons}},bind:function(){this.dom.element.bind.apply(this.dom.element,arguments);return this},triggerHandler:function(){this.dom.element.trigger.apply(this.dom.element,arguments);return this},_init:function(){var o=this;if(!this.cfg.showTitle){this.cfg.draggable=false}if(!isNaN(parseInt(this.cfg.top))||!isNaN(parseInt(this.cfg.left))||this.cfg.anchor){this.cfg.autoMiddle=false}var p="j-dialog "+(this.cfg.dialogClassName?this.cfg.dialogClassName:"");if(!f&&this.cfg.fixed){p+=" j-dialog-fix"}if(this.cfg.showShadow){p+=" j-dialog-shadow"}this._addMask();this.dom.element=g('<div class="'+p+'"></div>').css({zIndex:this.cfg.zIndex,display:"none"}).appendTo(document.body);this._setupTitleBar().title(this.cfg.title);this._setupContent().content(this.cfg.content);this.buttons(this.cfg.buttons);this.width(this.cfg.width);this.height(this.cfg.height);g("#j-dialog-body",this.dom.element).css("padding",this.cfg.padding);g.each(h,function(r,q){if(o.cfg.events[q]){o.dom.element.bind(q,{dialog:o},o.cfg.events[q])}});this._setupEscKey()._setupEnterKey()._setupBodyClick();this.cfg.autoShow&&this.show();if(this.cfg.anchor){this._tempVars.domAnchor=g(this.cfg.anchor.target);if(!this._tempVars.domAnchor[0]){throw new Error('The "anchor.target" must be a HTMLElement instance!');return this}this._setupTriangle()}else{if(this.cfg.autoMiddle){this.middle()}else{this.position({left:this.cfg.left,top:this.cfg.top})}}this._tempVars.onResize=function(){g(window).unbind("resize",o._tempVars.onResize);if(o.cfg.autoMiddle){o.middle()}o.triggerHandler("resize");o.sizeTimer=setTimeout(function(){g(window).bind("resize",o._tempVars.onResize)},10)};g(window).bind("resize",this._tempVars.onResize)},_addMask:function(){var o=this;if(this.cfg.modal){var p={};if(this.cfg.maskClassName){p.className=this.cfg.maskClassName}p.zIndex=this.cfg.zIndex;this.mask=jMask.init(p);if(this.cfg.wobbleEnable){this._tempVars.cssAnimationGoing=false;this.mask.element.click(function(q){if(o._tempVars.cssAnimationGoing){return false}o.dom.element.addClass("j-ani-wobble");o._tempVars.cssAnimationGoing=true;setTimeout(function(){o.dom.element.removeClass("j-ani-wobble");o._tempVars.cssAnimationGoing=false},1100)})}}return o},_setupBodyClick:function(){var o=this;if(!o.cfg.closeOnBodyClick){return this}var p=function(q){if(!g.contains(o.dom.element[0],q.target)){o.close()}};o.bind("show",function(q){g(document).bind("mousedown",p)});g.each(["hide","close"],function(r,q){o.bind(q,function(s){g(document).unbind("mousedown",p)})});return o},_setupTitleBar:function(){var o=this;if(this.cfg.closeable){var q=g('<a href="#" class="j-dialog-close" title="关闭">&nbsp;</a>').appendTo(this.dom.element).bind({click:function(r){o.cfg.hideOnClose?o.hide():o.close();r.preventDefault();r.stopPropagation()},mousedown:function(r){r.preventDefault();r.stopPropagation()}});if(!this.cfg.showTitle){q.addClass("btn-without-title")}}if(!this.cfg.showTitle){return o}this._tempVars.titleBar=g('<div class="j-dialog-title"><span class="j-dialog-txt"></span></div>').appendTo(this.dom.element);if(this.cfg.draggable){this._tempVars.titleBar.addClass("j-draggable");var p=null;this._tempVars.dragObj=jDrag.init({handle:o._tempVars.titleBar,target:o.dom.element,onDown:function(){o._setupHackDiv(1);o.dom.element.addClass("j-user-select")},onUp:function(){o._setupHackDiv(0);o.dom.element.removeClass("j-user-select")}})}return o},_setupHackDiv:function(q){var p=this;if(q){if(g("IFRAME",p.dom.element).length>0){var o=g(".j-dialog-content",p.dom.element);p.hack_div=(p.hack_div||g("<div></div>")).appendTo(o).css({position:"absolute",left:0,top:0,cursor:"move",display:"block",width:p.dom.element.outerWidth(),height:p.dom.element.outerHeight()})}}else{if(p.hack_div){p.hack_div.css("display","none")}}return p},_setupEscKey:function(){var o=this;var p=function(q){if(q.keyCode==27){o.triggerHandler("escKey")}};g(o.dom.element).bind("show",function(q){g(document).bind("keydown",p)});g.each(["hide","close"],function(r,q){g(o.dom.element).bind(q,function(s){g(document).unbind("keydown",p)})});return o},_setupEnterKey:function(){var o=this;var p=function(q){if(q.keyCode==13||q.keyCode==10){o.triggerHandler("enterKey")}};g(o.dom.element).bind("show",function(q){g(document).bind("keydown",p)});g.each(["hide","close"],function(r,q){g(o.dom.element).bind(q,function(s){g(document).unbind("keydown",p)})});return o},_setupTriangle:function(){this._tempVars.triangle=g(['<div class="j-triangle">','<div class="t-border"></div>','<div class="t-inset"></div>',"</div>"].join("")).appendTo(this.dom.element).addClass("anchor-"+{left:"right",right:"left",top:"bottom",bottom:"top"}[{left:"left","left-top":"left","left-bottom":"left",top:"top","top-left":"top","top-right":"top",right:"right","right-top":"right","right-bottom":"right",bottom:"bottom","bottom-left":"bottom","bottom-right":"bottom"}[this.cfg.anchor.position||"right"]]);var u={},o={};var t=this._tempVars.domAnchor.offset();var q={width:parseInt(this._tempVars.domAnchor.width(),10),height:parseInt(this._tempVars.domAnchor.height(),10)};var p={width:parseInt(this.width(),10),height:parseInt(this.height(),10)};var s=g.extend({top:0,left:0,right:0,bottom:0},this.cfg.anchor.offset||{});var r=parseInt(this.cfg.anchor.trianglePosFromStart,10)||0;switch((this.cfg.anchor.position||"right").toLowerCase()){case"top":u={top:0,left:r?r:(p.width-24)/2};o={top:t.top-p.height-12-s.top,left:t.left+(q.width-p.width)/2+s.left};break;case"top-left":u={top:0,left:r?r:(p.width-24)/2};o={top:t.top-p.height-12-s.top,left:t.left+s.left};break;case"top-right":u={top:0,left:r?p.width-24-r:(p.width-24)/2};o={top:t.top-p.height-12-s.top,left:(t.left+q.width)-p.width+s.right};break;case"right":u={top:r?r-p.height:-(p.height+24)/2,left:-24};o={top:t.top+(q.height-p.height)/2+s.top,left:t.left+q.width+12+s.right};break;case"right-top":u={top:r?r-p.height:-(p.height+24)/2,left:-24};o={top:t.top+s.top,left:t.left+q.width+12+s.right};break;case"right-bottom":u={top:r?-24-r:-(p.height+24)/2,left:-24};o={top:t.top+q.height-p.height-s.bottom,left:t.left+q.width+12+s.right};break;case"bottom":u={top:-(p.height+24),left:r?r:(p.width-24)/2};o={top:t.top+q.height+12+s.bottom,left:t.left+(q.width-p.width)/2+s.left};break;case"bottom-left":u={top:-(p.height+24),left:r?r:(p.width-24)/2};o={top:t.top+q.height+12+s.bottom,left:t.left+s.left};break;case"bottom-right":u={top:-(p.height+24),left:r?p.width-24-r:(p.width-24)/2};o={top:t.top+q.height+12+s.bottom,left:(t.left+q.width)-p.width+s.right};break;case"left":u={top:r?r-p.height:-(p.height+24)/2,left:p.width};o={top:t.top+(q.height-p.height)/2+s.top,left:t.left-p.width-12-s.left};break;case"left-top":u={top:r?r-p.height:-(p.height+24)/2,left:p.width};o={top:t.top+s.top,left:t.left-p.width-12-s.left};break;case"left-bottom":u={top:r?-24-r:-(p.height+24)/2,left:p.width};o={top:t.top+q.height-p.height-s.bottom,left:t.left-p.width-12-s.left};break}this._tempVars.triangle.css(u);this.position(o);this.dom.element.css("overflow","visible");return this},_setupContent:function(){if(this.cfg.contentType==="iframe"){this.cfg.content=g("<iframe></iframe>").css({width:"100%",height:"100%",border:"none"}).attr({src:this.cfg.content,frameBorder:0})}var q=g(['<div class="j-dialog-content">','<div class="j-dialog-body" id="j-dialog-body"></div>',"</div>"].join(""));var p=this;this.dom.element.append(q);if(this.cfg.resizable){var o=g(".j-dialog-content .j-dialog-body",p.dom.element);this.cfg.minWidth=this.cfg.minWidth||0;this.cfg.minHeight=this.cfg.minHeight||0;g.each(["es"],function(s,r){var u=g('<div class="resizable-'+r+'"><div></div></div>');p.dom.element.append(u);var w=null,t=null;jDrag.init({handle:u,onDown:function(v){p._setupHackDiv(1);w=parseInt(p.dom.element.width());t=parseInt(o.height());p.dom.element.addClass("j-user-select")},onMove:function(D,z,E){var C=w+z;var v=t+E;if(!((p.cfg.minWidth&&C<p.cfg.minWidth&&z<0)||(p.cfg.maxWidth&&(C>p.cfg.maxWidth)&&z>0))){p.dom.element.width(C)}if(!((p.cfg.minHeight&&(v<p.cfg.minHeight)&&E<0)||((p.cfg.maxHeight)&&(v>p.cfg.maxHeight)&&E>0))){o.height(v)}var A=p.dom.element.outerWidth(),B=p.dom.element.outerHeight();if(p.hack_div){p.hack_div.css({width:A,height:B})}},onUp:function(v){p._setupHackDiv(0);p.dom.element.removeClass("j-user-select")}})})}return p}};var b=function(p){var o=g.extend({},p||{});return new i(o)};var j=function(q,p,o){o=o||{};p=g.extend({type:"highlight",handler:function(r,s){s.close()}},p||{});o=g.extend({wobbleEnable:true},o,{content:q,buttons:[].concat(p),title:o.title?o.title:"提示"});return b(o)};var n=function(q,p,r,o){o=o||{};p=g.extend({type:"highlight",handler:function(s,t){t.close()}},p||{});r=g.extend({text:"取消",handler:function(s,t){t.close()}},r||{});o=g.extend({wobbleEnable:true},o,{content:q,buttons:[].concat([p,r]),title:o.title?o.title:"确认"});return b(o)};var m=function(p,o){o=o||{};o=g.extend({content:p,padding:"20px 10px 20px 10px",textAlign:"center"},o,{showTitle:false});return b(o)};var a=function(q,p,o){o=o||{};o=g.extend({padding:"20px 10px 20px 10px",textAlign:"center",width:"auto",anchor:{target:null,position:"right"}},o,{content:q,anchor:p,showTitle:false,showShadow:false,modal:false,fixed:false});return b(o)};var l=function(p,o){o=o||{};o=g.extend({content:p,title:"窗口",width:600,height:300},o,{contentType:"iframe"});return b(o)};return{version:"1.3",dialog:b,alert:j,confirm:n,message:m,tip:a,iframe:l}})(jQuery);